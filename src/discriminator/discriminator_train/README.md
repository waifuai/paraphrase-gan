# Discriminator Training

This directory contains scripts and resources for training a discriminator model that distinguishes between human-generated and machine-generated phrases. This is a crucial component for evaluating and improving the quality of text generated by other parts of the system.

## Overview

The primary goal is to train a model that can accurately identify whether a given phrase was written by a human or a machine. This is achieved by training a Transformer-based model using the Trax library on a dataset of labeled phrases. The trained discriminator model is then saved and can be used later to assess the quality of generated text.

**Training Workflow**

The overall training process can be summarized as follows:

1. **Data Preparation:** Input data (likely including `paraphrases_selected.tsv` and `paraphrases_generated.tsv`) is prepared and processed for Trax. This step might involve combining data sources, cleaning the text, and potentially tokenizing or encoding the phrases.
2. **Discriminator Training:** A Trax-based Transformer model is trained to classify input phrases as human-generated or machine-generated.
3. **Model Storage:** The trained discriminator model is saved for later use.

This can be visualized as:

```
Input Data (paraphrases_selected.tsv, paraphrases_generated.tsv, etc.)
          v
Data Preparation (discriminator_train_prep.sh)
          v
     DISCRIMINATOR TRAINING (discriminator_train_do.sh)
          v
     Trained Discriminator Model (model/)
```

## Components

### `discriminator_train.sh`

This is the main script that orchestrates the entire training process. It performs the following actions:

1. **Preparation:** Sets up the necessary directories and copies data to the `discriminator_train_prep/` directory.
2. **Data Preprocessing:** Executes `discriminator_train_prep.sh` to process the data.
3. **Training Data Copying:** Moves the processed data from `discriminator_train_prep/data/output/` to `discriminator_train_do/data/input/`.
4. **Training:** Executes `discriminator_train_do.sh` to train the discriminator model.
5. **Output:** The trained discriminator model is stored in the `model/` directory.

### `discriminator_train_prep/`

This directory (and its associated `discriminator_train_prep.sh` script) handles the preparation of the training data. The specifics of these steps are not fully detailed in the provided code, but it likely involves:

*   Reading data from `data/input/` (which may include `paraphrases_selected.tsv` and `paraphrases_generated.tsv`).
*   Potentially cleaning, filtering, or transforming the data.
*   Writing the processed data to `data/output/`, which is then used as input for the training stage.
*   Creating the subdirectory `t2t_data/discriminator` within `data/output/` which is specifically for Trax consumption.

### `discriminator_train_do/`

This directory contains the script (`discriminator_train_do.sh`) that performs the actual training of the discriminator model using Trax.

#### `discriminator_train_do/discriminator_train_do.sh`

This script does the following:

1. **Initialization:** Defines key variables like model name, problem name, data directory, output directory, and model directory.
2. **Directory Setup:** Creates the `data/output/` and `model/` directories if they don't exist.
3. **Trax Training:** Executes the Trax supervised trainer with the specified model ("transformer\_phrase\_discriminator"), problem ("phrase\_discriminator\_problem"), data directory, training steps, and evaluation parameters.
4. **Completion Message:** Prints a message indicating the completion of training and the location of the saved model.

#### `discriminator_train_do/data/input/paraphrases.tsv`

This is an example of the input format expected by the training script. The actual training data likely resides in `data/input/t2t_data/discriminator`.

This is a tab separated file with format:

```
phrase1\tparaphrase1
phrase2\tparaphrase2
phrase3\tparaphrase3
```

#### `discriminator_train_do/README.md`

Provides a detailed explanation of the `discriminator_train_do` component, including its purpose, script breakdown, directory structure, usage instructions, and prerequisites.

### `gen_mock_paraphrases.py`

This script generates mock data files, `paraphrases_selected.tsv` and `paraphrases_generated.tsv`, for testing or development purposes. It creates tab-separated files with repeated lines representing human and machine-generated phrases.

### `data/input/`

This directory contains the initial raw data for the discriminator. The exact content and format depend on the specifics of the project. Key files likely include:

*   `paraphrases_selected.tsv`: Likely contains pairs or groups of human-generated paraphrases.
*   `paraphrases_generated.tsv`: Likely contains pairs or groups of phrases, where one is human-generated and the other is machine-generated.

### `model/`

This directory stores the trained discriminator model after the `discriminator_train.sh` script is executed.

### `disc_train.ascii`

This file contains ASCII art that is displayed at the beginning of the `discriminator_train.sh` script's execution.

## Usage

To train the discriminator model:

1. **Ensure Prerequisites:**
    *   Python is installed.
    *   Trax is installed (`pip install trax`).
    *   The necessary raw data files are present in `data/input/`. This might require running other parts of the system that generate these files.

2. **Generate Mock Data (Optional):** If you need mock data for testing, run `gen_mock_paraphrases.py` to generate `paraphrases_selected.tsv` and `paraphrases_generated.tsv` in the `data/input` directory.

3. **Run the Main Script:**
    ```bash
    ./discriminator_train.sh
    ```

This script will handle data preparation, training, and saving the trained model to the `model/` directory.



# Discriminator Train

This component handles the preparation and training of a discriminator model. The discriminator's task is to determine whether a given phrase is human-generated or not.

## Scripts

-   `discriminator_train_prep.sh`: Prepares the training data.
-   `discriminator_train_do.sh`: Performs the training of the discriminator model.

## Training Process

The training process involves the following steps:

1. **Input:** `paraphrases_generated.tsv` containing a dataset of paraphrases.
2. **Data Preparation:** The `discriminator_train_prep.sh` script prepares the data for training.
3. **Model Training:** The `discriminator_train_do.sh` script trains the discriminator model using the prepared data.
4. **Output:** The trained discriminator model is saved in the `model` directory.

## Directory Structure

```
# Input
data
|-input
  |-paraphrases_generated.tsv

# Output
model
|-<trained discriminator model>
