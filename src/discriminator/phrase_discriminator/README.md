# Phrase Discriminator

This package defines a `trax` problem for discriminating whether a phrase is human-generated or machine-generated.

## Overview

The task is to classify input phrases as either being written by a human or generated by a machine. This is implemented as a binary classification problem using the `trax` library.

## Data

The input data is expected to be in TSV format, where each line contains a tab-separated list of phrases. The first phrase is considered the human-generated example, and the remaining phrases are considered machine-generated.

The `example_generator` function in `problem.py` parses this format and yields examples with the appropriate labels (1 for human, 0 for machine).

The default data path is set to:
`src/discriminator_train/discriminator_train_prep/data/input/paraphrases_generated.tsv`

## Problem Definition

The `PhraseDiscriminatorProblem` class defines the problem for `trax`. Key properties include:

- `is_generate_per_split`: True, indicating that data should be generated for each split (train/eval).
- `dataset_splits`: Defines the number of shards for train and eval splits.
- `approx_vocab_size`: Sets the approximate vocabulary size to 2^14.
- `num_classes`: 2 (human vs machine).
- `class_labels`: Returns the labels for each class.
- `generate_samples`: Generates training/evaluation samples from the input data.

The `PhraseDiscriminatorProblemCharacters` class inherits from `PhraseDiscriminatorProblem` and sets the `vocab_type` to `CHARACTER`, indicating that the model should operate at the character level.

## Setup

The `setup.py` file defines the package metadata and dependencies. The only required package is `trax`.

## Usage

This package is intended to be used within the `trax` framework to train and evaluate models for phrase discrimination.

To use this problem definition, you would typically import the `PhraseDiscriminatorProblem` or `PhraseDiscriminatorProblemCharacters` class in your `trax` training script and configure the `trainer.train` function accordingly.

## Example

```python
from trax.supervised import training
from src.discriminator.phrase_discriminator.trainer.problem import PhraseDiscriminatorProblem

# ... define your model ...

problem = PhraseDiscriminatorProblem()

train_task = training.TrainTask(
    labeled_data=problem.train_stream(data_dir),
    loss_layer=tl.CategoryCrossEntropy(),
    optimizer=trax.optimizers.Adam(0.01),
    n_steps_per_checkpoint=100,
)

# ... define eval task ...

trainer = training.Trainer(
    model=model,
    train_task=train_task,
    eval_tasks=[eval_task],
    output_dir=output_dir
)

trainer.train(n_steps=1000)
```